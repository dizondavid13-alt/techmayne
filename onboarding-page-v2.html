<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TechMayne - Client Onboarding</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.3em;
      color: #667eea;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .required {
      color: #e53e3e;
    }

    input[type="text"],
    input[type="email"],
    input[type="url"],
    input[type="tel"],
    input[type="color"],
    input[type="password"],
    select,
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
      font-family: inherit;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .color-input-wrapper {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    input[type="color"] {
      width: 80px;
      height: 50px;
      padding: 5px;
      cursor: pointer;
    }

    .color-preview {
      flex: 1;
      height: 50px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .helper-text {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }

    .checkbox-group {
      display: flex;
      align-items: start;
      gap: 10px;
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
    }

    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
    }

    .checkbox-group label {
      margin: 0;
      cursor: pointer;
      flex: 1;
    }

    .installation-section {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
    }

    .installation-section.show {
      display: block;
    }

    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .warning-box strong {
      color: #856404;
    }

    .faq-item {
      margin-bottom: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .faq-item input {
      margin-bottom: 10px;
    }

    .add-faq-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95em;
      font-weight: 600;
      transition: background 0.3s;
    }

    .add-faq-btn:hover {
      background: #5568d3;
    }

    .remove-faq-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85em;
      float: right;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .result-card {
      display: none;
      background: #f0fdf4;
      border: 2px solid #86efac;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    .result-card.show {
      display: block;
    }

    .result-title {
      color: #166534;
      font-size: 1.3em;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .embed-code {
      background: #1e293b;
      color: #10b981;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      overflow-x: auto;
      margin: 15px 0;
      position: relative;
    }

    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #10b981;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.85em;
    }

    .copy-btn:hover {
      background: #059669;
    }

    .instructions {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .instructions h4 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .instructions ol {
      margin-left: 20px;
    }

    .instructions li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .error-message {
      background: #fee2e2;
      color: #991b1b;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    details {
      margin: 10px 0;
      cursor: pointer;
    }

    summary {
      font-weight: 600;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
    }

    summary:hover {
      background: #e9ecef;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéâ Welcome to TechMayne</h1>
      <p>Let's customize your chatbot in 5 minutes!</p>
    </div>

    <form id="onboardingForm" class="card">
      <h2 class="section-title">üìã Business Information</h2>

      <div class="form-group">
        <label>Business Name <span class="required">*</span></label>
        <input type="text" id="businessName" name="businessName" required placeholder="e.g., Sarah Johnson Photography">
      </div>

      <div class="form-group">
        <label>Website URL <span class="required">*</span></label>
        <input type="url" id="websiteUrl" name="websiteUrl" required placeholder="https://yourwebsite.com">
      </div>

      <div class="form-group">
        <label>Notification Email <span class="required">*</span></label>
        <input type="email" id="notificationEmail" name="notificationEmail" required placeholder="you@email.com">
        <div class="helper-text">You'll receive lead notifications here</div>
      </div>

      <div class="form-group">
        <label>Phone Number <span class="required">*</span></label>
        <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="(555) 123-4567">
        <div class="helper-text">For urgent notifications and support</div>
      </div>

      <h2 class="section-title" style="margin-top: 30px;">üé® Customize Your Chatbot</h2>

      <div class="form-group">
        <label>Booking/Calendar Link</label>
        <input type="url" id="bookingLink" name="bookingLink" placeholder="https://calendly.com/yourusername">
        <div class="helper-text">Optional: Calendly, Acuity, or any scheduling link</div>
      </div>

      <div class="form-group">
        <label>Service Area</label>
        <input type="text" id="serviceArea" name="serviceArea" placeholder="e.g., San Francisco Bay Area">
        <div class="helper-text">Where do you offer your services?</div>
      </div>

      <div class="form-group">
        <label>Starting Price</label>
        <input type="text" id="startingPrice" name="startingPrice" placeholder="e.g., $2,500">
        <div class="helper-text">Your packages starting price (displayed to visitors)</div>
      </div>

      <div class="form-group">
        <label>Gallery Delivery Timeline</label>
        <input type="text" id="galleryTimeline" name="galleryTimeline" placeholder="e.g., 4-6 weeks" value="4-6 weeks">
        <div class="helper-text">How long until clients receive their photos?</div>
      </div>

      <div class="form-group">
        <label>Chatbot Accent Color</label>
        <div class="color-input-wrapper">
          <input type="color" id="accentColor" name="accentColor" value="#6366f1">
          <div class="color-preview" id="colorPreview" style="background: #6366f1;">
            <span style="color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">#6366f1</span>
          </div>
        </div>
        <div class="helper-text">Choose a color that matches your brand</div>
      </div>

      <h2 class="section-title" style="margin-top: 30px;">üí¨ Custom FAQs (Optional)</h2>
      <p style="margin-bottom: 15px; color: #666;">Add questions specific to your business. We've already included 4 default FAQs for you!</p>

      <div id="customFaqContainer"></div>

      <button type="button" class="add-faq-btn" onclick="addCustomFaq()">+ Add Custom FAQ</button>

      <h2 class="section-title" style="margin-top: 30px;">‚öôÔ∏è Installation Preference</h2>

      <div class="checkbox-group">
        <input type="checkbox" id="needInstallation" name="needInstallation" onchange="toggleInstallationSection()">
        <label for="needInstallation">
          <strong>I need help installing the chatbot</strong><br>
          <span class="helper-text">Check this if you'd like us to install the chatbot for you within 48 hours ($50 one-time fee)</span>
        </label>
      </div>

      <div id="installationSection" class="installation-section">
        <h3 style="color: #856404; margin-bottom: 15px;">üîß Installation Service Details</h3>

        <div class="warning-box">
          <strong>üîí Your Information is Secure</strong><br>
          We only use your login credentials to install the chatbot code on your website. We'll never access any other data or make unauthorized changes. Your credentials are deleted immediately after installation.
        </div>

        <div class="form-group">
          <label>Website Platform <span class="required">*</span></label>
          <select id="websitePlatform" name="websitePlatform">
            <option value="">Select your platform</option>
            <option value="squarespace">Squarespace</option>
            <option value="wordpress">WordPress</option>
            <option value="wix">Wix</option>
            <option value="showit">Showit</option>
            <option value="shopify">Shopify</option>
            <option value="weebly">Weebly</option>
            <option value="godaddy">GoDaddy Website Builder</option>
            <option value="other">Other (please specify below)</option>
          </select>
        </div>

        <div class="form-group">
          <label>Website Login Username/Email <span class="required">*</span></label>
          <input type="text" id="websiteUsername" name="websiteUsername" placeholder="your_username or email@example.com">
        </div>

        <div class="form-group">
          <label>Website Login Password <span class="required">*</span></label>
          <input type="password" id="websitePassword" name="websitePassword" placeholder="Your password">
          <div class="helper-text">Your password is encrypted and deleted after installation</div>
        </div>

        <div class="form-group">
          <label>Two-Factor Authentication (2FA) Status</label>
          <select id="twoFactorStatus" name="twoFactorStatus">
            <option value="disabled">Disabled - No 2FA on my account</option>
            <option value="enabled_can_disable">Enabled - I can temporarily disable it</option>
            <option value="enabled_will_provide">Enabled - I'll provide the code when needed</option>
          </select>
          <div class="helper-text">If enabled, we'll text you via SMS when we need the 2FA code (time-sensitive)</div>
        </div>

        <div class="form-group">
          <label>Special Instructions (Optional)</label>
          <textarea id="installationNotes" name="installationNotes" placeholder="Any special instructions or concerns about your website setup?"></textarea>
        </div>

        <div class="checkbox-group" style="background: #d1ecf1; border-color: #17a2b8;">
          <input type="checkbox" id="installationConsent" name="installationConsent">
          <label for="installationConsent">
            <strong style="color: #0c5460;">I authorize TechMayne to access my website</strong><br>
            <span style="color: #0c5460;">I understand that TechMayne will access my website solely to install the chatbot code and will not make any other changes. My credentials will be deleted after installation.</span>
          </label>
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        üöÄ Complete Setup
      </button>

      <div id="errorMessage" class="error-message"></div>
    </form>

    <div id="resultCard" class="card result-card">
      <div class="result-title">‚úÖ Success! Your Chatbot is Ready</div>

      <div id="installationMessage" style="display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
        <strong>üîß Installation Service Selected</strong><br>
        We'll install the chatbot on your website within the next 48 hours. You'll receive an email when it's live!<br><br>
        If you have 2FA enabled, please watch for our email requesting the verification code.
      </div>

      <p><strong>Client Token:</strong> <code id="clientToken"></code></p>

      <div id="embedCodeSection" style="margin-top: 20px;">
        <strong>Your Embed Code:</strong>
        <div class="helper-text" style="margin-bottom: 10px;">You can also install this yourself if you'd like!</div>
        <div class="embed-code" id="embedCodeContainer">
          <button class="copy-btn" onclick="copyEmbedCode()">Copy</button>
          <code id="embedCode"></code>
        </div>
      </div>

      <div class="instructions">
        <h4>üìù DIY Installation Instructions (If You Prefer)</h4>

        <details>
          <summary>Squarespace</summary>
          <ol style="margin-top: 10px;">
            <li>Go to Settings ‚Üí Advanced ‚Üí Code Injection</li>
            <li>Paste the code in the "Footer" section</li>
            <li>Click Save</li>
          </ol>
        </details>

        <details>
          <summary>WordPress</summary>
          <ol style="margin-top: 10px;">
            <li>Install plugin "Insert Headers and Footers"</li>
            <li>Go to Settings ‚Üí Insert Headers and Footers</li>
            <li>Paste code in "Scripts in Footer"</li>
            <li>Save</li>
          </ol>
        </details>

        <details>
          <summary>Wix</summary>
          <ol style="margin-top: 10px;">
            <li>Go to Settings ‚Üí Custom Code</li>
            <li>Click "+ Add Custom Code"</li>
            <li>Paste code, select "Body - End"</li>
            <li>Apply to all pages</li>
          </ol>
        </details>

        <details>
          <summary>Showit</summary>
          <ol style="margin-top: 10px;">
            <li>Go to Site Settings ‚Üí Advanced ‚Üí Custom Code</li>
            <li>Paste in "Footer Code" section</li>
            <li>Publish your site</li>
          </ol>
        </details>
      </div>

      <div style="margin-top: 20px; padding: 15px; background: #d1f2eb; border-radius: 8px; border-left: 4px solid #28a745;">
        <strong>‚úÖ What happens next:</strong><br>
        ‚Ä¢ You'll receive a confirmation email with all your details<br>
        ‚Ä¢ We've been notified of your signup<br>
        <span id="installationNextSteps">‚Ä¢ Your chatbot will be installed within 48 hours</span>
        <span id="diyNextSteps" style="display: none;">‚Ä¢ Install the embed code on your website<br>‚Ä¢ Visit your site to test the chatbot!</span>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'https://techmayne-production.up.railway.app';

    let customFaqCount = 0;

    // Color preview
    document.getElementById('accentColor').addEventListener('input', function(e) {
      const color = e.target.value;
      const preview = document.getElementById('colorPreview');
      preview.style.background = color;
      preview.querySelector('span').textContent = color;
    });

    // Toggle installation section
    function toggleInstallationSection() {
      const checkbox = document.getElementById('needInstallation');
      const section = document.getElementById('installationSection');

      if (checkbox.checked) {
        section.classList.add('show');
        // Make installation fields required
        document.getElementById('websitePlatform').required = true;
        document.getElementById('websiteUsername').required = true;
        document.getElementById('websitePassword').required = true;
      } else {
        section.classList.remove('show');
        // Make installation fields optional
        document.getElementById('websitePlatform').required = false;
        document.getElementById('websiteUsername').required = false;
        document.getElementById('websitePassword').required = false;
      }
    }

    // Add custom FAQ
    function addCustomFaq() {
      customFaqCount++;
      const container = document.getElementById('customFaqContainer');

      const faqItem = document.createElement('div');
      faqItem.className = 'faq-item';
      faqItem.id = `faq-${customFaqCount}`;
      faqItem.innerHTML = `
        <button type="button" class="remove-faq-btn" onclick="removeFaq(${customFaqCount})">Remove</button>
        <label>Question:</label>
        <input type="text" name="faq_question_${customFaqCount}" placeholder="e.g., Do you offer engagement sessions?">

        <label style="margin-top: 10px;">Answer:</label>
        <textarea name="faq_answer_${customFaqCount}" placeholder="Your answer here..." style="min-height: 80px;"></textarea>

        <label style="margin-top: 10px;">Keywords (comma-separated):</label>
        <input type="text" name="faq_keywords_${customFaqCount}" placeholder="e.g., engagement, session, couples">
        <div class="helper-text">Keywords help the chatbot match this FAQ to visitor questions</div>
      `;

      container.appendChild(faqItem);
    }

    // Remove FAQ
    function removeFaq(id) {
      const faqItem = document.getElementById(`faq-${id}`);
      faqItem.remove();
    }

    // Form submission
    document.getElementById('onboardingForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      const errorMessage = document.getElementById('errorMessage');
      const resultCard = document.getElementById('resultCard');
      const needInstallation = document.getElementById('needInstallation').checked;

      // Validate installation consent if installation is selected
      if (needInstallation) {
        const consent = document.getElementById('installationConsent').checked;
        if (!consent) {
          errorMessage.textContent = 'Please authorize us to access your website for installation.';
          errorMessage.classList.add('show');
          return;
        }
      }

      // Disable button
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Creating your chatbot...';
      errorMessage.classList.remove('show');
      resultCard.classList.remove('show');

      // Gather custom FAQs
      const customFaqs = [];
      for (let i = 1; i <= customFaqCount; i++) {
        const questionInput = document.querySelector(`input[name="faq_question_${i}"]`);
        const answerInput = document.querySelector(`textarea[name="faq_answer_${i}"]`);
        const keywordsInput = document.querySelector(`input[name="faq_keywords_${i}"]`);

        if (questionInput && questionInput.value && answerInput && answerInput.value) {
          customFaqs.push({
            question: questionInput.value,
            answer: answerInput.value,
            keywords: keywordsInput ? keywordsInput.value : '' // Keep as comma-separated string
          });
        }
      }

      // Gather form data
      const formData = {
        businessName: document.getElementById('businessName').value,
        websiteUrl: document.getElementById('websiteUrl').value,
        notificationEmail: document.getElementById('notificationEmail').value,
        phoneNumber: document.getElementById('phoneNumber').value,
        bookingLink: document.getElementById('bookingLink').value || null,
        serviceArea: document.getElementById('serviceArea').value || null,
        startingPrice: document.getElementById('startingPrice').value || null,
        galleryTimeline: document.getElementById('galleryTimeline').value || '4-6 weeks',
        accentColor: document.getElementById('accentColor').value,
        customFaqs: customFaqs
      };

      // Add installation data if selected
      if (needInstallation) {
        formData.installation = {
          needsInstallation: true,
          platform: document.getElementById('websitePlatform').value,
          username: document.getElementById('websiteUsername').value,
          password: document.getElementById('websitePassword').value,
          twoFactorStatus: document.getElementById('twoFactorStatus').value,
          instructions: document.getElementById('installationNotes').value || null
        };
      }

      try {
        // Call API
        const response = await fetch(`${API_URL}/api/onboarding/create`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
          // Show success
          document.getElementById('clientToken').textContent = data.client.clientToken;
          document.getElementById('embedCode').textContent = data.embedCode;

          // Show/hide installation-specific messages
          if (needInstallation) {
            document.getElementById('installationMessage').style.display = 'block';
            document.getElementById('installationNextSteps').style.display = 'block';
            document.getElementById('diyNextSteps').style.display = 'none';
          } else {
            document.getElementById('installationMessage').style.display = 'none';
            document.getElementById('installationNextSteps').style.display = 'none';
            document.getElementById('diyNextSteps').style.display = 'block';
          }

          resultCard.classList.add('show');

          // Scroll to result
          resultCard.scrollIntoView({ behavior: 'smooth' });
        } else {
          throw new Error(data.error || 'Something went wrong');
        }
      } catch (error) {
        errorMessage.textContent = `Error: ${error.message}`;
        errorMessage.classList.add('show');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üöÄ Complete Setup';
      }
    });

    function copyEmbedCode() {
      const code = document.getElementById('embedCode').textContent;
      navigator.clipboard.writeText(code);

      const btn = event.target;
      btn.textContent = '‚úì Copied!';
      setTimeout(() => {
        btn.textContent = 'Copy';
      }, 2000);
    }
  </script>
</body>
</html>
